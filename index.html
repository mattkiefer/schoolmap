<!DOCTYPE html>
<meta charset="utf-8">
<style></style>
<body>
<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="https://d3js.org/topojson.v1.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script>

// drawing map on svg
var width = 960
    height = 1160

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)

var projection = d3.geo.mercator()
    .center([-87.7, 41.9 ])
    .scale([width * 80])

var path = d3.geo.path().projection(projection)


// presentation metadata (e.g. map color schemes) for each dataset
var data_configs = {
                    /*
                    'example': {
                                'property_name' : {string} key to look up json data 
                                'button_name'   : {string} how to present the toggle switch
                                'domain_type'   : {string} ordinal or quantize
                                'scale_range'   : {array} the range of values (ordinal: array, quantize: min/max)
                                'color_palette' : {array} from colorbrewer 
                               }
                    ,
                    */
                    'default': {
                                'property_name' : 'default',
                                'button_name'   : null,
                                'domain_type'   : null,
                                'scale_range'   : null,
                                'color_palette' : null,
                               }
                    ,
                    'race'   : {
                                'properties'    : 'racial_majority',
                                'button_name'   : 'Racial majority',
                                'domain_type'   : 'ordinal',
                                'scale_range'   : ['Black','White','Hispanic','Mixed'],
                                'color_palette' : ['#a6cee3','#1f78b4', '#b2df8a', '#33a02c']
                               }
                    ,
                    'hs'     : {
                                'properties'    : 'racial_majority',
                                'button_name'   : 'No college',
                                'domain_type'   : 'quantize',
                                'scale_range'   : null, // min/max
                                'color_palette' : ["rgb(237,248,233)", "rgb(186,228,179)","rgb(116,196,118)", "rgb(49,163,84)","rgb(0,109,44)"],
                               }
}


var map = d3.json("viz_data/data.geojson", function(json) {
    // get data and shapes
    var comm_areas = json.features
  
    // TODO: figure out how to handle defaults 
    config = null
    
    // load switches and click events from var data_configs
    for (config_name in data_configs) {
        if (config_name != 'default') {
            this_config = data_configs[config_name]
            button_name = this_config['button_name']
            // instantiate the toggle switches
            d3.select("body").append("p").attr("id",this_config['properties']).html(button_name)
            // add onclicks, set global config
            .on("click",function(this_config) { config = this_config; })
        }
    }    
    
    // handle ordinal (text) vs quantize (numerical) choropleths 
    if (! config) {
        // but first check if we have a dataset selected
        // ... and if not, pass
    } else {
        if (config['domain_type'] == 'ordinal') {
            var color = d3.scale.ordinal()
            color.domain([config['scale_range']])
        } else {
            try {
                var color = d3.scale.quantize()
                min = d3.min(function(d) {d.properties.getAttribute(config['property_name'])}) 
                max = d3.max(function(d) {d.properties.getAttribute(config['property_name'])}) 
                color.domain([min,max])
            } catch(err) {
                console.log(err)
            }
        }

    // add colors
    color.range(config['color_palette'])
    }

    var clicky = d3.select("body").append("div").attr("id","clicker").html("clicky click").on("click", function(comm_areas) {
    svg.selectAll(".cas").attr("fill", function(d) { return color(d.properties.racial_majority) } );
    console.log(foo)
    })

    var foo = svg.selectAll("path")
    .data(comm_areas)
    .enter()
    .append("path")
    .attr("d",path)
    .attr("class","cas")
    .attr("fill","#CCCCCC")
    
})

</script>
