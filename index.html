<!DOCTYPE html>
<meta charset="utf-8">
<style></style>
<body>
<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="https://d3js.org/topojson.v1.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script>

// drawing map on svg
var width = 960
    height = 700

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)

var projection = d3.geo.mercator()
    .center([-87.7, 41.9 ])
    .scale([width * 80])

var path = d3.geo.path().projection(projection)

var default_color = '#CCCCCC'



// testing how to make a map color key
var test_key_group = d3.select("svg").append("g").attr("id","test_key")
var test_key_text  = test_key_group.append("text").text("test")
test_key_text.attr({
        id : 'test_key_text',
        x  : 200,
        y  : 200,
        })
var test_key_rect = test_key_group.append("rect")
test_key_rect.attr({
        fill  : "#00FF00",
        x      : 200,
        y      : 250,
        width  : 100,
        height : 100,
        })



// presentation metadata (e.g. map color schemes) for each dataset
var data_configs = {
                    /*
                    'example': {
                                'properties'    : {string} key to look up json data 
                                'button_name'   : {string} how to present the toggle switch
                                'domain_type'   : {string} ordinal or quantize
                                'scale_range'   : {array} the range of values (ordinal: array, quantize: min/max)
                                'color_palette' : {array} from colorbrewer 
                               }
                    ,
                    */
                    'default': {
                                'properties'    : 'default',
                                'button_name'   : null,
                                'domain_type'   : null,
                                'scale_range'   : null,
                                'color_palette' : null,
                               }
                    ,
                    'race'   : {
                                'properties'    : 'racial_majority',
                                'button_name'   : 'Racial majority',
                                'domain_type'   : 'ordinal',
                                'scale_range'   : ['Black','White','Hispanic','Mixed'],
                                'color_palette' : ['#a6cee3','#1f78b4', '#b2df8a', '#33a02c']
                               }
                    ,
                    'hs'     : {
                                'properties'    : 'hs_diploma_or_less',
                                'button_name'   : 'No college',
                                'domain_type'   : 'quantize',
                                'scale_range'   : null, // min/max
                                'color_palette' : ["rgb(237,248,233)", "rgb(186,228,179)","rgb(116,196,118)", "rgb(49,163,84)","rgb(0,109,44)"],
                               }
}


var map = d3.json("viz_data/data.geojson", function(json) {
    // get data and shapes
    comm_areas = json.features
  
    // TODO: figure out how to handle default configs 
    config = null
    
    // default map
    svg.selectAll("path")
    .data(comm_areas)
    .enter()
    .append("path")
    .attr("d",path)
    .attr("class","cas")
    .attr("fill", default_color)
 
    
    // load switches and click events from var data_configs
    for (config_name in data_configs) {
        if (config_name != 'default') {
            var this_config = data_configs[config_name]
            button_name = this_config['button_name']
            // instantiate the toggle switches
            d3.select("body").append("p").attr("id",config_name).html(button_name)
            // add onclicks, set global config
            












            
            .on("click",function() { 
                config = data_configs[this.id]
                // handle ordinal (text) vs quantize (numerical) choropleths 
                if (! config) {
                    // but first check if we have a dataset selected
                    // ... and if not, pass
                } else {
                    if (config['domain_type'] == 'ordinal') {
                        color = d3.scale.ordinal()
                        color.domain([config['scale_range']])
                    } else {
                        try {
                            color = d3.scale.quantize()
                            min = d3.min(comm_areas, function(ca) {return ca.properties[config.properties]})
                            max = d3.max(comm_areas, function(ca) {return ca.properties[config.properties]})
                            color.domain([min, max])
                        } catch(err) {
                            console.log(err)
                        }
                    }
                // add colors
                color.range(config['color_palette'])
                debugger;
                svg.selectAll(".cas").attr("fill", function(d) {  return color(d.properties[config.properties]) })
                }
            })









        }
    }    
    
  
})

</script>
